
## DOM的缺陷

DOM的创建会受到JS操作的影响，而JS修改DOM操作很有可能影响到整个渲染流水线，在发生重排重绘的情况下。 因而如果在一颗相对比较复杂的DOM树上直接对它进行操作，频繁的发生重排重绘或者合成，会导致操作过程非常耗时，会性能有很大的影响。

因而才需要产生出虚拟DOM。

## 什么是虚拟 DOM

虚拟DOM需要解决的事

- 将页面改变的内容应用到虚拟DOM上，而不是直接操作DOM
- 变化到虚拟DOM上时，并不急着去渲染页面，而是仅仅修改虚拟DOM内部的状态
- 在虚拟DOM收集到足够的改变时，一次性的去应用到真实DOM上

![](https://raw.githubusercontent.com/SilverCoin0214/XavierCoinPic/main/image/%08js/202302021517877.png)

### 虚拟DOM的运行、
- 创建阶段。首先依据JSX和基础数据结构创建出虚拟DOM，它反应了真实DOM树的结构。然后由虚拟DOM树创建出真实DOM树， 在真实DOM创建后， 进入后续渲染流水线。
- 更新阶段。 如果数据发生了改变， 那么就需要依据新的数据创建出一颗新的虚拟DOM树，然后通过对比两棵树， 找出变化的地方， 将变化的地方一次性更新到真实的DOM树上。最后再进入渲染流水线流程。


**1. 双缓存**

双缓存就是将计算的中间结果先放在另一个缓冲区中，等待全部计算结束，该缓冲区已经存储了完整的图形之后， 再将该缓冲区的图形数据一次性复制到缓冲区上。然后进行输出。

也就是实际上存在两个缓冲区，主副切换。

**2. MVC 模式**

MVC的核心思想就是将数据和视图分离。视图和模型之间是不允许通信的。而是通过控制器来完成，通常情况下的通信路径是视图发生了改变， 然后通知控制器，控制器再根据情况判断是否要更新模型数据。

![](https://raw.githubusercontent.com/SilverCoin0214/XavierCoinPic/main/image/%08js/202302021548896.png)

-   图中的控制器是用来监控 DOM 的变化，一旦 DOM 发生变化，控制器便会通知模型，让其更新数据；
-   模型数据更新好之后，控制器会通知视图，告诉它模型的数据发生了变化；
-   视图接收到更新消息之后，会根据模型所提供的数据来生成新的虚拟 DOM；
-   新的虚拟 DOM 生成好之后，就需要与之前的虚拟 DOM 进行比较，找出变化的节点；
-   比较出变化的节点之后，React 将变化的虚拟节点应用到 DOM 上，这样就会触发 DOM 节点的更新；
-   DOM 节点的变化又会触发后续一系列渲染流水线的变化，从而实现页面的更新



