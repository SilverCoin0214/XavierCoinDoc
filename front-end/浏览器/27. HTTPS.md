![](https://raw.githubusercontent.com/SilverCoin0214/XavierCoinPic/main/image/%08js/202302022201682.png)

##   在 HTTP 协议栈中引入安全层

安全层有两个主要的职责： 对发起HTTP请求的数据进行加密操作和对接收到的HTTP内容进行解密操作。

非对称加密是指， 浏览器向服务器发送自己的公钥， 服务器向浏览器发送自己的公钥。 之后通信过程中， 浏览器用服务器的公钥进行加密后传输， 服务器收到时用自身的私钥解密。 反之也是一样。

缺陷：
-   **第一个是非对称加密的效率太低**。这会严重影响到加解密数据的速度，进而影响到用户打开页面的速度。
-   **第二个是无法保证服务器发送给浏览器的数据安全**。虽然浏览器端可以使用公钥来加密，但是服务器端只能采用私钥来加密，私钥加密只有公钥能解密，但黑客也是可以获取得到公钥的，这样就不能保证服务器端数据的安全了。

### 对称加密和非对称加密搭配使用


![](https://raw.githubusercontent.com/SilverCoin0214/XavierCoinPic/main/image/%08js/202302022211284.png)


-   首先浏览器向服务器发送对称加密套件列表、非对称加密套件列表和随机数 client-random；
-   服务器保存随机数 client-random，选择对称加密和非对称加密的套件，然后生成随机数 service-random，向浏览器发送选择的加密套件、service-random 和公钥；
-   浏览器保存公钥，并利用 client-random 和 service-random 计算出来 pre-master，然后利用公钥对 pre-master 加密，并向服务器发送加密后的数据；
-   最后服务器拿出自己的私钥，解密出 pre-master 数据，并返回确认消息。

###   第四版：添加数字证书

对于浏览器来说，数字证书有两个作用：一个是通过数字证书向浏览器证明服务器的身份，另一个是数字证书里面包含了服务器公钥。

![](https://raw.githubusercontent.com/SilverCoin0214/XavierCoinPic/main/image/%08js/202302022218928.png)


-   服务器没有直接返回公钥给浏览器，而是返回了数字证书，而公钥正是包含在数字证书中的；
-   在浏览器端多了一个证书验证的操作，验证了证书之后，才继续后续流程。

